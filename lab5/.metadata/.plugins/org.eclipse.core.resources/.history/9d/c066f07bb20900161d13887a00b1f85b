#include "rle.h"
#include "basic_io.h"
#include "image.h"

int hw_compressImage(char* output, char image[][Y]) {
    return 0;
}

int compressImage(char* output, char image[][Y]) {
    int total = 0;
    
    int x, y;
    int outputLength = 0;
    unsigned int num = 0;
    unsigned char bit = image[0][0] & 0x01;
    
    for (x = 0; x < X; x++) {
        for (y = 0; y < Y; y++) {
            if (bit == (image[x][y] & 0x01)) {
                num++;
            } else {
                output[outputLength++] = (bit << 7) | ((num >> 16) & 0x7F);
                output[outputLength++] = (num >> 8) & 0xFF;
                output[outputLength++] = num & 0xFF;
                
                total += num;
                
                num = 1;
                bit = image[x][y] & 0x01;
            }
        }
        if ((total + num) != x*Y) {
            printf("%d missing %d pixels\n", x, ((x * Y) - (total + num)));
        }
    }
    
    if
    
    printf("%d pixels\n", total);
    
    return outputLength;
}

void decompressImage(char output[][Y], char* input, int inputLength) {
    int total = 0;
    
    int i, j;
    int x = 0;
    int y = 0;
    unsigned int num;
    unsigned char bit;
    for (i = 0; i < inputLength; i += 3) {
        num = ((input[i] & 0x7F) << 16) | ((input[i + 1] & 0xFF) << 8) | (input[i + 2] & 0xFF);
        bit = (input[i] >> 7) & 0x01;
        
        total += num;
        
        for (j = 0; j < num; j++) {
            output[x][y] = bit;
            y++;
            if (y == 480) {
                y = 0;
                x++;
            }
        }
    }
    printf("%d pixels\n", total);
    printf("%d,%d %d\n\n", x, y, i);
}
